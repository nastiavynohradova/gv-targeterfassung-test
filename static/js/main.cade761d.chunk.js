(this["webpackJsonpgv-targeterfassung"]=this["webpackJsonpgv-targeterfassung"]||[]).push([[0],{100:function(e,t,a){},109:function(e,t,a){},110:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(9),c=a.n(o),l=a(147),s=a(71),i=a.n(s);a(100);function m(){return new Promise((e,t)=>{const a=indexedDB.open("Au\xdfendienstDB",1);a.onupgradeneeded=e=>{e.target.result.createObjectStore("submissions",{keyPath:"id",autoIncrement:!0})},a.onsuccess=t=>{const a=t.target.result;e(a)},a.onerror=e=>{t(e.target.error)}})}function u(e,t){return new Promise((a,n)=>{const r=e.transaction(["submissions"],"readwrite").objectStore("submissions").add(t);r.onsuccess=()=>{a()},r.onerror=()=>{n(r.error)}})}function d(e){return new Promise((t,a)=>{const n=e.transaction(["submissions"],"readonly").objectStore("submissions").getAll();n.onsuccess=()=>{t(n.result)},n.onerror=()=>{a(n.error)}})}async function g(e,t){const a=e.transaction("submissions","readwrite"),n=a.objectStore("submissions");await n.delete(t),await a.complete}var p=a(72),f=a.n(p),b=a(166),h=a(113),v=a(112),k=a(150),S=a(154),E=a(158),w=a(159),y=a(170),j=a(152),x=a(171),O=a(155),_=a(169),D=a(176),C=a(157),V=a(172),I=Object(l.a)((function(e){return{title:{fontWeight:"bold",fontSize:"1.2rem",marginBottom:"5px"}}})),N=function(e){var t=e.value,a=e.setValue,n=e.name,o=e.disabled,c=I();return r.a.createElement(r.a.Fragment,null,r.a.createElement(v.a,{variant:"h5",className:c.title},n),r.a.createElement(V.a,{required:!0,disabled:o,fullWidth:!0,name:n,value:t,onChange:function(e){var t=e.target.value;"Streckennummer"===n&&(t=Math.max(0,parseInt(t,10)).toString().slice(0,4)),a(t)},margin:"normal",inputProps:{style:{textAlign:"center"}}}),r.a.createElement("br",null))},B=a(77),T=a.n(B),W=a(55),L=a.n(W),z=Object(l.a)((function(e){return{button:{margin:e.spacing(1),padding:"10px 20px",fontSize:"1rem",textTransform:"none"},buttonsContainer:{display:"flex",flexDirection:"row",alignItems:"center"},buttonContainer:{textAlign:"center",marginTop:e.spacing(2)}}})),A=function(e){var t=e.handleSubmit,a=e.downloadCombinedTodayData,n=e.downloadCombinedData,o=z();return r.a.createElement(b.a,{className:o.buttonContainer},r.a.createElement(S.a,{variant:"contained",color:"primary",className:o.button,endIcon:r.a.createElement(T.a,null),onClick:t},"Abspeichern"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(b.a,{className:o.buttonsContainer},r.a.createElement(S.a,{variant:"contained",color:"primary",className:o.button,startIcon:r.a.createElement(L.a,null),onClick:function(){return a()}},"Daten von heute herunterladen"),r.a.createElement(S.a,{variant:"contained",color:"primary",className:o.button,startIcon:r.a.createElement(L.a,null),onClick:function(){return n()}},"Alle Daten herunterladen")))},P=a(38),F=a.n(P),M=a(175),R=a(167),K=a(174),U=a(56);const q=Object(l.a)(e=>({title:{fontWeight:"bold",fontSize:"1.2rem",marginBottom:"5px",textAlign:"center"},textField:{marginBottom:"1px"},successSnackbar:{backgroundColor:e.palette.success.main,color:e.palette.success.contrastText},errorSnackbar:{backgroundColor:e.palette.error.main,color:e.palette.error.contrastText}})),H=(e,t)=>{const a=q(),[o,c]=Object(n.useState)(""),[l,s]=Object(n.useState)(""),[i,g]=Object(n.useState)(""),[p,f]=Object(n.useState)(""),[h,k]=Object(n.useState)(!1),[S,E]=Object(n.useState)(""),[w,I]=Object(n.useState)(""),[B,T]=Object(n.useState)(null),[W,L]=Object(n.useState)(null),[z,P]=Object(n.useState)(""),[H,G]=Object(n.useState)(""),[J,Z]=Object(n.useState)(null),{onClose:$,selectedValue:Q,open:X}=e,[Y,ee]=Object(n.useState)(""),[te,ae]=Object(n.useState)(""),[ne,re]=Object(n.useState)([]),[oe,ce]=Object(n.useState)(!1),[le,se]=Object(n.useState)("");Object(n.useEffect)(()=>{se((new Date).toISOString().slice(0,10))},[le,se]);const ie=Object(n.useRef)(null),me=[{value:10,label:"Keiner"},{value:20,label:"Laterne"},{value:30,label:"Wand"},{value:40,label:"Fundament"},{value:50,label:"L\xe4rmschutzwand"},{value:60,label:"Widerlager"},{value:70,label:"Sonstiges"}],ue=[{value:1,label:"Neu vermarkter GVP mit Target"},{value:2,label:"Vorhanden (nicht in Auswahl) mit Target"}];return r.a.createElement(y.a,{open:e.open,onClose:e.onClose},r.a.createElement(b.a,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",maxWidth:"400px",margin:"0 auto",padding:"20px",marginTop:"10px",border:"1px solid #ccc",borderRadius:"8px",boxShadow:"0 0 5px rgba(0, 0, 0, 0.2)"},r.a.createElement(N,{name:"Punktnummer",value:o,setValue:c}),r.a.createElement(N,{name:"Streckennummer",value:l,setValue:s}),r.a.createElement(v.a,{variant:"h6",className:a.title},"Kilometrierung [km]"),r.a.createElement(b.a,{display:"flex",flexDirection:"row",alignItems:"center"},r.a.createElement(V.a,{required:!0,value:i,style:{marginRight:"5px"},id:"km",name:"km",placeholder:"z.B. 695",onChange:e=>g(e.target.value),inputProps:{style:{textAlign:"center"},maxLength:2}}),r.a.createElement(v.a,null,", "),r.a.createElement(V.a,{required:!0,value:p,style:{marginLeft:"5px"},id:"met",name:"met",placeholder:"87",onChange:e=>f(e.target.value),inputProps:{style:{textAlign:"center"},maxLength:3}})),r.a.createElement("br",null),r.a.createElement(v.a,{variant:"h6",className:a.title},"Seite (bezogen auf Strecke)"),r.a.createElement(b.a,{display:"flex",flexDirection:"row",alignItems:"center"},r.a.createElement(j.a,{component:"fieldset"},r.a.createElement(x.a,{row:!0,required:!0,id:"seite",name:"seite",value:h,onChange:e=>k(e.target.value)},r.a.createElement(O.a,{value:"L",control:r.a.createElement(_.a,null),label:"L"}),r.a.createElement(O.a,{value:"R",control:r.a.createElement(_.a,null),label:"R"}))),r.a.createElement(V.a,{fullWidth:!0,value:S,onChange:e=>E(e.target.value),label:"Sonstiges",id:"sonstiges",name:"sonstiges",InputLabelProps:{style:{textAlign:"center",width:"100%",marginLeft:"0"}},inputProps:{style:{textAlign:"center"}}})),r.a.createElement("br",null),r.a.createElement(N,{name:"Mastnummer",value:w,setValue:I,disabled:null!==W&&10!==W}),r.a.createElement(v.a,{variant:"h6",className:a.title},"Status:"),r.a.createElement(j.a,{fullWidth:!0},r.a.createElement(R.a,{labelId:"status",id:"status",value:B,label:"Status",onChange:e=>(e=>{T(e.target.value)})(e)},ue.map(e=>r.a.createElement(M.a,{key:e.value,value:e.value},e.label)))),r.a.createElement(v.a,{variant:"h6",className:a.title},"Wenn keine Mastnummer vorhanden ist, dann Vermarkungstr\xe4ger ausw\xe4hlen:"),r.a.createElement(j.a,{fullWidth:!0},r.a.createElement(K.a,{id:"demo-simple-select-label"},"Vermarkungstr\xe4ger"),r.a.createElement(R.a,{labelId:"vermarkungstraeger",id:"vermarkungstraeger",value:W,label:"Vermarkung",onChange:e=>(e=>{L(e.target.value),e.target.value&&I("")})(e),disabled:!!w},me.map(e=>r.a.createElement(M.a,{key:e.value,value:e.value},e.label)))),r.a.createElement(N,{name:"Sonstiges",value:z,setValue:P,disabled:70!==W}),r.a.createElement("br",null),r.a.createElement(N,{name:"Offset [mm]",value:H,setValue:G}),r.a.createElement("br",null),r.a.createElement(v.a,{variant:"h6",className:a.title},"Datum"),r.a.createElement("br",null),r.a.createElement(V.a,{required:!0,fullWidth:!0,name:"currentDate",placeholder:"z.B. 2023-10-20",value:le,onChange:e=>{se(e.target.value)},margin:"normal",inputProps:{style:{textAlign:"center"}}}),r.a.createElement("br",null),r.a.createElement(v.a,{variant:"h6",className:a.title},"Foto hochladen"),r.a.createElement("input",{ref:e=>ie.current=e,required:!0,type:"file",name:"photo",accept:"image/*;capture=camera",onChange:e=>(e=>{const t=e.target.files[0];Z(t)})(e)})),r.a.createElement(A,{handleSubmit:()=>{if(!J)return ae("Bitte w\xe4hlen Sie ein Foto aus, bevor Sie fortfahren."),void ee("");if(!l)return ae("Bitte geben Sie die Streckennummer ein, bevor Sie fortfahren."),void ee("");if(!i&!p)return ae("Bitte geben Sie die Kilometrierung ein, bevor Sie fortfahren."),void ee("");if(!h)return ae("Bitte w\xe4hlen Sie eine Seite aus, bevor Sie fortfahren."),void ee("");if(!w)return ae("Bitte geben Sie eine Mastnummer ein, bevor Sie fortfahren."),void ee("");if(!B)return ae("Bitte w\xe4hlen Sie einen Status aus, bevor Sie fortfahren."),void ee("");c(""),s(""),g(""),f(""),k(!1),E(""),I(""),T(null),L(null),G(""),P(""),Z(null),se((new Date).toISOString().slice(0,10));const e=new FileReader;e.onload=async e=>{const t=e.target.result;const a=new Image;a.src=t,a.onload=async()=>{if(e.total<=524288){var n,r;const e=W?null===(n=me.find(e=>e.value===W))||void 0===n?void 0:n.label:"",a=B?null===(r=ue.find(e=>e.value===B))||void 0===r?void 0:r.label:"",c={punktnummer:o,streckennummer:l,km:i,met:p,seite:h,sonstiges:S,mastnummer:w,selectedVermarkungstrager:e,selectedStatus:a,sonstiges2:z,gvp:H,currentDate:le,photo:t};try{const e=await m();await u(e,c);const t=await d(e);re(t),ee("Erfolgreich hinzugef\xfcgt"),ce(!0)}catch(g){console.error("Error adding or fetching submission: ",g)}finally{setTimeout(()=>{ee("")},3e3)}}else{const e=document.createElement("canvas"),t=e.getContext("2d");e.width=a.width,e.height=a.height,t.drawImage(a,0,0,a.width,a.height);try{var c,s;const t=await new Promise(t=>{e.toBlob(t,"image/jpeg",1)}),a=await Object(U.a)(t,{maxSizeMB:.5,maxWidthOrHeight:1920,useWebWorker:!0});console.log("compressedFile instanceof Blob",a instanceof Blob),console.log("compressedFile size ".concat(a.size/1024/1024," MB"));const n=W?null===(c=me.find(e=>e.value===W))||void 0===c?void 0:c.label:"",r=B?null===(s=ue.find(e=>e.value===B))||void 0===s?void 0:s.label:"",f={punktnummer:o,streckennummer:l,km:i,met:p,seite:h,sonstiges:S,mastnummer:w,selectedStatus:r,selectedVermarkungstrager:n,sonstiges2:z,gvp:H,currentDate:le,photo:a};try{const e=await m();await u(e,f);const t=await d(e);re(t),ee("Erfolgreich hinzugef\xfcgt"),ce(!0)}catch(g){console.error("Error adding or fetching submission: ",g)}}catch(g){console.error("Error compressing photo: ",g)}}}},e.readAsDataURL(J),ie.current.value=""},downloadCombinedData:()=>{const e=new F.a,t="Punktnummer; Streckennummer;Kilometrierung; Seite (bezogen auf Strecke); Sonstiges; Mastnummer; Status; Vermarkung; Sonstiges Vermarkung; Offset [m]; Datum\n"+ne.map(e=>{const t=(e.gvp/1e3).toLocaleString("de-DE",{minimumFractionDigits:2});return"".concat(e.punktnummer,";").concat(e.streckennummer,";").concat(e.km,",").concat(e.met,";").concat(e.seite,";").concat(e.sonstiges,";").concat(e.mastnummer,";").concat(e.selectedStatus,";").concat(e.selectedVermarkungstrager,";").concat(e.sonstiges2,";").concat(t,";").concat(e.currentDate)}).join("\n");e.file("alle_daten.csv",t);const a=e.folder("Vorhanden_mit_Target"),n=e.folder("Vorhanden_ohne_Target");ne.forEach((e,t)=>{const r=e.currentDate.replace(/-/g,"");let o,c,l;if(e.met&&e.met.toString().length>=3){const t=parseFloat(e.met),a=10*Math.round(t/10);o=Math.floor(a/10)}else o=e.met;if(c="Vorhanden ohne Target"===e.selectedStatus?n:a,e.mastnummer&&e.mastnummer.endsWith("N")){let t=e.mastnummer;t=t.trim().slice(0,-1),l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(t,"_").concat(r,".jpg")}else if(e.selectedVermarkungstrager&&"Sonstiges"!==e.selectedVermarkungstrager)l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(e.selectedVermarkungstrager,"_").concat(r,".jpg");else if(e.sonstiges2)l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(e.sonstiges2,"_").concat(r,".jpg");else{if(!e.mastnummer)return void console.error("Invalid submission data");l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(e.mastnummer,"_").concat(r,".jpg")}if(e.photo instanceof Blob)c.file(l,e.photo);else if("string"===typeof e.photo){const t=e.photo.split(",")[1];c.file(l,t,{base64:!0})}}),e.generateAsync({type:"blob"}).then(e=>{const t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="combined_data.zip",setTimeout(()=>{a.click()},100)})},downloadCombinedTodayData:()=>{const e=new F.a,t=ne.filter(e=>e.currentDate===le),a="Punktnummer; Streckennummer; Kilometrierung; Seite (bezogen auf Strecke); Sonstiges; Mastnummer; Status; Vermarkung; Sonstiges Vermarkung; Offset [m]; Datum\n"+t.map(e=>{const t=(e.gvp/1e3).toLocaleString("de-DE",{minimumFractionDigits:2});return"".concat(e.punktnummer,";").concat(e.streckennummer,";").concat(e.km,",").concat(e.met,";").concat(e.seite,";").concat(e.sonstiges,";").concat(e.mastnummer,";").concat(e.selectedStatus,";").concat(e.selectedVermarkungstrager,";").concat(e.sonstiges2,";").concat(t,";").concat(le)}).join("\n");e.file("".concat(le,".csv"),a);const n=e.folder("Vorhanden_mit_Target"),r=e.folder("Vorhanden_ohne_Target");t.forEach((e,t)=>{const a=e.currentDate.replace(/-/g,"");let o,c,l;if(e.met&&e.met.toString().length>=3){const t=parseFloat(e.met),a=10*Math.round(t/10);o=Math.floor(a/10)}else o=e.met;if(c="Vorhanden ohne Target"===e.selectedStatus?r:n,e.mastnummer&&e.mastnummer.endsWith("N")){let t=e.mastnummer;t=t.trim().slice(0,-1),l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(t,"_").concat(a,".jpg")}else if(e.selectedVermarkungstrager&&"Sonstiges"!==e.selectedVermarkungstrager)l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(e.selectedVermarkungstrager,"_").concat(a,".jpg");else if(e.sonstiges2)l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(e.sonstiges2,"_").concat(a,".jpg");else{if(!e.mastnummer)return void console.error("Invalid submission data");l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(e.mastnummer,"_").concat(a,".jpg")}if(e.photo instanceof Blob)c.file(l,e.photo);else if("string"===typeof e.photo){const t=e.photo.split(",")[1];c.file(l,t,{base64:!0})}}),e.generateAsync({type:"blob"}).then(e=>{const t=(new Date).toISOString().slice(0,10),a=window.URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download="".concat(t,".zip"),setTimeout(()=>{n.click()},100)})}}),r.a.createElement(D.a,{open:!!Y,autoHideDuration:7e3,onClose:(e,t)=>{"clickaway"!==t&&(ee(""),ce(!1))}},r.a.createElement(C.a,{message:Y,className:a.successSnackbar})),r.a.createElement(D.a,{open:!!te,autoHideDuration:12e3,onClose:(e,t)=>{"clickaway"!==t&&ae("")}},r.a.createElement(C.a,{message:te,className:a.errorSnackbar})))};const G=Object(l.a)(e=>({header:{padding:e.spacing(2),backgroundColor:e.palette.primary.main,color:e.palette.common.white},content:{padding:e.spacing(3),backgroundColor:e.palette.background.paper},buttonContainer:{marginTop:e.spacing(2),textAlign:"center"},button:{display:"block",margin:"10px auto",padding:"10px 20px",fontSize:"1rem",textTransform:"none",backgroundColor:"#6a8dbb",color:e.palette.common.white,"&:hover":{backgroundColor:"#3c5a7d"}},input:{display:"none"}}));var J=e=>{let{setShowTable:t,setImportData:a,setColNames:o}=e;const c=G(),[l,s]=Object(n.useState)(!1),[i,m]=Object(n.useState)(!1),[u,d]=Object(n.useState)(!1);return r.a.createElement(b.a,null,r.a.createElement(h.a,{className:c.header,elevation:3},r.a.createElement(v.a,{variant:"h4"},"GV-Targeterfassung")),r.a.createElement(h.a,{className:c.content,elevation:3},r.a.createElement(b.a,{className:c.buttonContainer},r.a.createElement("label",{htmlFor:"csv-input"},r.a.createElement(k.a,{accept:".csv",className:c.input,id:"csv-input",type:"file",onChange:e=>{const n=e.target.files[0];n?"text/csv"===n.type||n.name.endsWith(".csv")?(((e,t,a)=>{f.a.parse(e,{complete:n=>{const r=e.name?e.name.split(".").at(0):"";if(n.data&&n.data.length>0){Object.keys(n.data[0]);const e=n.data.slice(0,-1),o=["PktNr","Km-Station Ist"],c=e.map((e,t)=>{const a={id:t,Streckennummer:r,"Offset [mm]":""};return o.forEach(t=>{if("Km-Station Ist"===t){const n=e[t].toString().split(",")[0].replace(/\D/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,",");a[t]=n}else a[t]=e[t]}),a});t(c),a([...o,"Streckennummer","Offset [mm]"])}else console.error("CSV file is empty or missing data.")},header:!0,encoding:"ISO-8859-1"})})(n,a,o),t(!0),m(!0),d(!1)):(d(!0),m(!1)):(m(!1),d(!1))}}),r.a.createElement(S.a,{variant:"contained",startIcon:r.a.createElement(E.a,null),color:"secondary",className:c.button,component:"span"},"Koordinatendatei hochladen")),u&&r.a.createElement(v.a,{variant:"body2",color:"error"},"W\xe4hlen Sie eine CSV Datei")),r.a.createElement(b.a,null,r.a.createElement(S.a,{variant:"contained",startIcon:r.a.createElement(w.a,null),color:"secondary",className:c.button,component:"span",onClick:()=>{s(!0)}},"Neupunkt erfassen"),r.a.createElement(H,{selectedValue:"",open:l,onClose:e=>{s(!1)}}))))},Z=a(161),$=a(165),Q=a(164),X=a(160),Y=a(162),ee=a(163);const te=Object(l.a)(e=>({title:{fontWeight:"bold",fontSize:"1.2rem",marginBottom:"5px"},textField:{marginBottom:"1px"},successSnackbar:{backgroundColor:e.palette.success.main,color:e.palette.success.contrastText},errorSnackbar:{backgroundColor:e.palette.error.main,color:e.palette.error.contrastText}}));var ae=e=>{let{reff:t,row:a,setImportData:o,onSubmitSuccess:c,setOpen:l}=e;const[s,i]=Object(n.useState)({seite:!1,sonstiges:"",gvp:"",photo:null}),[p,f]=Object(n.useState)(a.PktNr?a.PktNr:""),[h,k]=Object(n.useState)(a.Streckennummer?a.Streckennummer:""),[S,E]=Object(n.useState)(a["Km-Station Ist"]?a["Km-Station Ist"]:""),[w,y]=Object(n.useState)(a.Met?a.Met:""),[I,B]=Object(n.useState)(""),[T,W]=Object(n.useState)(""),[L,z]=Object(n.useState)(""),[P,q]=Object(n.useState)(null),[H,G]=Object(n.useState)(null),[J,Z]=Object(n.useState)(""),[$,Q]=Object(n.useState)(""),[X,Y]=Object(n.useState)(""),[ee,ae]=Object(n.useState)(""),[ne,re]=Object(n.useState)(""),[oe,ce]=Object(n.useState)([]);Object(n.useEffect)(()=>{o(e=>e.map(e=>e.id===a.id?{...e,"Offset [mm]":$}:e.id===a.id?{...e,Mastnummer:L}:e))},[$,L,a.id,o]);const[le,se]=Object(n.useState)(!1),[ie,me]=Object(n.useState)("");Object(n.useEffect)(()=>{if(me((new Date).toISOString().slice(0,10)),a){if(a["Km-Station Ist"]){const[e,t]=a["Km-Station Ist"].split(",");E(e),y(t)}a.Seite&&B(a.Seite)}},[a,me]);const ue=te(),de=[{value:10,label:"Keiner"},{value:20,label:"Laterne"},{value:30,label:"Wand"},{value:40,label:"Fundament"},{value:50,label:"L\xe4rmschutzwand"},{value:60,label:"Widerlager"},{value:70,label:"Sonstiges"}],ge=[{value:1,label:"Zerst\xf6rt"},{value:2,label:"Vorhanden mit Target"},{value:3,label:"Vorhanden ohne Target"}],pe=()=>{i({km:"",met:"",seite:"",sonstiges:"",punktnummer:"",gvp:"",photo:null})},fe=e=>{const{name:t,value:a}=e.target;i({...s,[t]:a})};return Object(n.useEffect)(()=>{m().then(e=>{d(e).then(e=>ce(e))}).catch(e=>console.error("Error opening database: ",e))},[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(b.a,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",maxWidth:"400px",margin:"0 auto",padding:"20px",border:"1px solid #ccc",borderRadius:"8px",boxShadow:"0 0 5px rgba(0, 0, 0, 0.2)"},r.a.createElement(N,{value:p,setValue:f,name:"Punktnummer"}),r.a.createElement(N,{value:h,setValue:k,name:"Streckennummer"}),r.a.createElement(v.a,{variant:"h6",className:ue.title},"Kilometrierung [km]"),r.a.createElement(b.a,{display:"flex",flexDirection:"row",alignItems:"center"},r.a.createElement(V.a,{required:!0,style:{marginRight:"5px"},id:"km",name:"km",placeholder:"z.B. 69",value:S,onChange:fe,inputProps:{style:{textAlign:"center"},maxLength:2}}),r.a.createElement(v.a,null,", "),r.a.createElement(V.a,{required:!0,style:{marginLeft:"5px"},id:"met",name:"met",placeholder:"875",value:w,onChange:fe,inputProps:{style:{textAlign:"center"},maxLength:3}})),r.a.createElement("br",null),r.a.createElement(v.a,{variant:"h6",className:ue.title},"Seite (bezogen auf Strecke)"),r.a.createElement(b.a,{display:"flex",flexDirection:"row",alignItems:"center"},r.a.createElement(j.a,{component:"fieldset"},r.a.createElement(x.a,{row:!0,required:!0,id:"seite",name:"seite",value:I,onChange:e=>B(e.target.value)},r.a.createElement(O.a,{value:"L",control:r.a.createElement(_.a,null),label:"L"}),r.a.createElement(O.a,{value:"R",control:r.a.createElement(_.a,null),label:"R"}))),r.a.createElement(V.a,{fullWidth:!0,label:"Sonstiges",id:"sonstiges",name:"sonstiges",value:T,onChange:e=>W(e.target.value),inputProps:{style:{textAlign:"center"}},InputLabelProps:{style:{textAlign:"center",width:"100%",marginLeft:"0"}}})),r.a.createElement("br",null),r.a.createElement(N,{name:"Mastnummer",value:L,setValue:z,disabled:null!==P&&10!==P}),r.a.createElement(v.a,{variant:"h6",className:ue.title},"Status"),r.a.createElement(j.a,{fullWidth:!0},r.a.createElement(R.a,{labelId:"status",id:"status",value:H,label:"Status",onChange:e=>(e=>{G(e.target.value)})(e)},ge.map(e=>r.a.createElement(M.a,{key:e.value,value:e.value},e.label)))),r.a.createElement(v.a,{variant:"h6",className:ue.title},"Wenn keine Mastnummer vorhanden ist, dann Vermarkungstr\xe4ger ausw\xe4hlen:"),r.a.createElement(j.a,{fullWidth:!0},r.a.createElement(K.a,{id:"demo-simple-select-label"},"Vermarkungstr\xe4ger"),r.a.createElement(R.a,{labelId:"vermarkungstraeger",id:"vermarkungstraeger",value:P,label:"Vermarkung",onChange:e=>(e=>{q(e.target.value),e.target.value&&z("")})(e),disabled:!!L},de.map(e=>r.a.createElement(M.a,{key:e.value,value:e.value},e.label)))),r.a.createElement(N,{name:"Sonstiges",value:J,setValue:Z,disabled:70!==P}),r.a.createElement("br",null),r.a.createElement(N,{value:$,setValue:e=>{Q(3===H?"":e)},name:"Offset [mm]",disabled:3===H}),r.a.createElement("br",null),r.a.createElement(v.a,{variant:"h6",className:ue.title},"Datum"),r.a.createElement("br",null),r.a.createElement(V.a,{required:!0,fullWidth:!0,name:"currentDate",placeholder:"z.B. 2023-10-20",value:ie,onChange:e=>{me(e.target.value)},margin:"normal",inputProps:{style:{textAlign:"center"}}}),r.a.createElement("br",null),r.a.createElement(v.a,{variant:"h6",className:ue.title},"Foto hochladen"),r.a.createElement("input",{ref:e=>t.current=e,required:!0,type:"file",name:"photo",accept:"image/*;capture=camera",onChange:e=>(e=>{const t=e.target.files[0];Y(t)})(e)})),r.a.createElement(A,{handleSubmit:()=>{if(!X)return re("Bitte w\xe4hlen Sie ein Foto aus, bevor Sie fortfahren."),void ae("");if(!h)return re("Bitte geben Sie die Streckennummer ein, bevor Sie fortfahren."),void ae("");if(!S&!w)return re("Bitte geben Sie die Kilometrierung ein, bevor Sie fortfahren."),void ae("");if(!I)return re("Bitte w\xe4hlen Sie eine Seite aus, bevor Sie fortfahren."),void ae("");if(!L)return re("Bitte geben Sie eine Mastnummer ein, bevor Sie fortfahren."),void ae("");if(!H)return re("Bitte w\xe4hlen Sie einen Status aus, bevor Sie fortfahren."),void ae("");pe();const e=new FileReader;e.onload=async e=>{const t=e.target.result;const a=new Image;a.src=t,a.onload=async()=>{if(e.total<=524288){var n,r;const e=P?null===(n=de.find(e=>e.value===P))||void 0===n?void 0:n.label:"",a=H?null===(r=ge.find(e=>e.value===H))||void 0===r?void 0:r.label:"",o={punktnummer:p,streckennummer:h,km:S,met:w,seite:I,sonstiges:T,mastnummer:L,selectedVermarkungstrager:e,selectedStatus:a,sonstiges2:J,gvp:$,currentDate:ie,photo:t};try{const e=await m();let t=await d(e);const a=t.findIndex(e=>e.streckennummer===o.streckennummer&&e.km===o.km&&e.punktnummer===o.punktnummer&&e.met===o.met);console.log(a),-1!==a&&await g(e,t[a].id),await u(e,o),ce(t),ae("Erfolgreich hinzugef\xfcgt"),l(!1),se(!0)}catch(s){console.error("Error adding or fetching submission: ",s)}}else{const e=document.createElement("canvas"),t=e.getContext("2d");e.width=a.width,e.height=a.height,t.drawImage(a,0,0,a.width,a.height);try{var o,c;const t=await new Promise(t=>{e.toBlob(t,"image/jpeg",1)}),a=await Object(U.a)(t,{maxSizeMB:.5,maxWidthOrHeight:1920,useWebWorker:!0});console.log("compressedFile instanceof Blob",a instanceof Blob),console.log("compressedFile size ".concat(a.size/1024/1024," MB"));const n=P?null===(o=de.find(e=>e.value===P))||void 0===o?void 0:o.label:"",r=H?null===(c=ge.find(e=>e.value===H))||void 0===c?void 0:c.label:"",l={punktnummer:p,streckennummer:h,km:S,met:w,seite:I,sonstiges:T,mastnummer:L,selectedVermarkungstrager:n,selectedStatus:r,sonstiges2:J,gvp:$,currentDate:ie,photo:a};try{const e=await m();let t=await d(e);const a=t.findIndex(e=>e.streckennummer===l.streckennummer&&e.km===l.km&&e.punktnummer===l.punktnummer&&e.met===l.met);console.log(a),-1!==a&&await g(e,t[a].id),await u(e,l),ce(t),ae("Erfolgreich hinzugef\xfcgt"),se(!0)}catch(s){console.error("Error adding or fetching submission: ",s)}}catch(s){console.error("Error compressing photo: ",s)}}}},e.readAsDataURL(X),t.current.value=""},downloadCombinedData:()=>{const e=new F.a,t="Punktnummer;Streckennummer;Kilometrierung; Seite (bezogen auf Strecke); Sonstiges; Mastnummer; Status; Vermarkung; Sonstiges Vermarkung; Offset [m]; Datum\n"+oe.map(e=>{const t=(e.gvp/1e3).toLocaleString("de-DE",{minimumFractionDigits:2});return"".concat(e.punktnummer,";").concat(e.streckennummer,";").concat(e.km,",").concat(e.met,";").concat(e.seite,";").concat(e.sonstiges,";").concat(e.mastnummer,";").concat(e.selectedStatus,";").concat(e.selectedVermarkungstrager,";").concat(e.sonstiges2,";").concat(t,";").concat(e.currentDate)}).join("\n");e.file("alle_daten.csv",t);const a=e.folder("Vorhanden_mit_Target"),n=e.folder("Vorhanden_ohne_Target");oe.forEach((e,t)=>{const r=e.currentDate.replace(/-/g,"");let o,c,l;if(e.met&&e.met.toString().length>=3){const t=parseFloat(e.met),a=10*Math.round(t/10);o=Math.floor(a/10)}else o=e.met;if("Vorhanden ohne Target"===e.selectedStatus?c=a:"Vorhanden ohne Target"===e.selectedStatus&&(c=n),e.mastnummer)l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(e.mastnummer,"_").concat(r,".jpg");else if(e.selectedVermarkungstrager&&"Sonstiges"!==e.selectedVermarkungstrager)l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(e.selectedVermarkungstrager,"_").concat(r,".jpg");else{if(!e.sonstiges2)return void console.error("Invalid submission data");l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(e.sonstiges2,"_").concat(r,".jpg")}if(e.photo instanceof Blob)c.file(l,e.photo);else if("string"===typeof e.photo){const t=e.photo.split(",")[1];c.file(l,t,{base64:!0})}}),e.generateAsync({type:"blob"}).then(e=>{const t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="combined_data.zip",setTimeout(()=>{a.click()},100)})},downloadCombinedTodayData:()=>{const e=new F.a,t=oe.filter(e=>e.currentDate===ie),a="Punktnummer;Streckennummer;Kilometrierung; Seite (bezogen auf Strecke); Sonstiges; Mastnummer; Status; Vermarkung; Sonstiges Vermarkung; Offset [m]; Datum\n"+t.map(e=>{const t=(e.gvp/1e3).toLocaleString("de-DE",{minimumFractionDigits:2});return"".concat(e.punktnummer,";").concat(e.streckennummer,";").concat(e.km,",").concat(e.met,";").concat(e.seite,";").concat(e.sonstiges,";").concat(e.mastnummer,";").concat(e.selectedStatus,";").concat(e.selectedVermarkungstrager,";").concat(e.sonstiges2,";").concat(t,";").concat(ie)}).join("\n");e.file("".concat(ie,".csv"),a);const n=e.folder("Vorhanden_mit_Target"),r=e.folder("Vorhanden_ohne_Target");t.forEach((e,t)=>{const a=e.currentDate.replace(/-/g,"");let o,c,l;if(e.met&&e.met.toString().length>=3){const t=parseFloat(e.met),a=10*Math.round(t/10);o=Math.floor(a/10)}else o=e.met;if(c="Vorhanden ohne Target"===e.selectedStatus?r:n,e.mastnummer&&e.mastnummer.endsWith("N")){let t=e.mastnummer;t=t.trim().slice(0,-1),l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(t,"_").concat(a,".jpg")}else if(e.selectedVermarkungstrager&&"Sonstiges"!==e.selectedVermarkungstrager)l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(e.selectedVermarkungstrager,"_").concat(a,".jpg");else if(e.sonstiges2)l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(e.sonstiges2,"_").concat(a,".jpg");else{if(!e.mastnummer)return void console.error("Invalid submission data");l="".concat(e.streckennummer,"_").concat(e.km,",").concat(o,"_").concat(e.seite,"_").concat(e.mastnummer,"_").concat(a,".jpg")}if(e.photo instanceof Blob)c.file(l,e.photo);else if("string"===typeof e.photo){const t=e.photo.split(",")[1];c.file(l,t,{base64:!0})}}),e.generateAsync({type:"blob"}).then(e=>{const t=(new Date).toISOString().slice(0,10),a=window.URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download="".concat(t,".zip"),setTimeout(()=>{n.click()},100)})}}),r.a.createElement(D.a,{open:!!ee,autoHideDuration:7e3,onClose:(e,t)=>{"clickaway"!==t&&ae("")}},r.a.createElement(C.a,{message:ee,className:ue.successSnackbar})),r.a.createElement(D.a,{open:!!ne,autoHideDuration:12e3,onClose:(e,t)=>{"clickaway"!==t&&re("")}},r.a.createElement(C.a,{message:ne,className:ue.errorSnackbar})))},ne=a(156),re=a(78),oe=a.n(re);const ce=Object(l.a)(e=>({paper:{padding:e.spacing(3)},successSnackbar:{backgroundColor:"#92b493"},errorSnackbar:{backgroundColor:"#FF5722"},buttonContainer:{textAlign:"center",marginTop:e.spacing(2)},button:{margin:e.spacing(1),padding:"10px 20px",fontSize:"1rem",textTransform:"none"}}));function le(e){let{row:t,onClose:a,selectedValue:n,open:o,reff:c,setImportData:l,setOpen:s}=e;const i=ce();return r.a.createElement(y.a,{onClose:()=>{a(n)},"aria-labelledby":"simple-dialog-title",open:o},r.a.createElement(h.a,{elevation:3,className:i.paper},r.a.createElement(ae,{row:t,reff:c,setImportData:l,setOpen:s})))}var se=e=>{let{row:t,reff:a,selectedRowData:n,setImportData:o}=e;const c=ce(),[l,s]=r.a.useState(!1),[i,m]=r.a.useState([]),u=()=>{setTimeout(()=>{s(!1)},2e3)};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:c.buttonContainer},r.a.createElement(ne.a,{"aria-label":"edit",onClick:()=>{s(!0)},className:c.button},"Bearbeiten",r.a.createElement(oe.a,null)),r.a.createElement(le,{row:t,selectedValue:i,open:l,onClose:u,reff:a,selectedRowData:n,setImportData:o,setOpen:u})))},ie=Object(l.a)((function(e){return{table:{minWidth:650},tableHead:{backgroundColor:"#6a8dbb",color:e.palette.common.white},editButton:{color:e.palette.secondary.main}}})),me=function(e){var t=e.importData,a=e.reff,n=e.setImportData,o=e.colNames;console.log(o);var c=ie();return r.a.createElement(X.a,{component:h.a},r.a.createElement(Z.a,{className:c.table,"aria-label":"enhanced table"},r.a.createElement(Y.a,null,r.a.createElement(ee.a,{className:c.tableHead},o.map((function(e,t){return r.a.createElement(Q.a,{key:"keys-".concat(t),align:"right"},e)})),r.a.createElement(Q.a,{key:"keys-edit",align:"right"}))),r.a.createElement($.a,null,t.map((function(e,t){return r.a.createElement(ee.a,{key:t},o.map((function(t,a){return r.a.createElement(Q.a,{key:"values-".concat(a),align:"right"},e[t])})),r.a.createElement(Q.a,{key:"values-edit",align:"right"},r.a.createElement(se,{row:e,reff:a,setImportData:n})))})))))};const ue=Object(l.a)(e=>({root:{flexWrap:"wrap",width:"100%",height:"100%",backgroundColor:"#f4f4f4",display:"flex",justifyContent:"center","& > *":{padding:"10px",display:"flex",flexDirection:"column"}}}));var de=()=>{const e=ue(),t=Object(n.useRef)(null),[a,o]=Object(n.useState)(!1),[c,l]=Object(n.useState)([]),[s,u]=Object(n.useState)([]),[d,g]=Object(n.useState)(!1);Object(n.useEffect)(()=>{const e=new Date,t=new Date(e);t.setHours(24,0,0,0);const a=12096e5+(t-e),n=setInterval(async()=>{try{const e=await m();await(async e=>new Promise((t,a)=>{const n=e.transaction(["submissions"],"readwrite").objectStore("submissions").clear();n.onsuccess=()=>{t()},n.onerror=e=>{a(e.target.error)}}))(e),console.log("IndexedDB cleared.")}catch(e){console.error("Error clearing IndexedDB: ",e)}},a);return console.log(a),()=>{clearInterval(n)}},[]);return r.a.createElement("div",{className:i()(e.root,"appWrapper")},r.a.createElement(J,{setShowTable:e=>{g(e),o(e)},setImportData:l,setColNames:u}),d&&r.a.createElement(r.a.Fragment,null,r.a.createElement(me,{importData:c,reff:t,setImportData:l,colNames:s})))},ge=(a(109),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function pe(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(de,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/gv-targeterfassung-test",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/gv-targeterfassung-test","/service-worker.js");ge?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):pe(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):pe(t,e)}))}}()},95:function(e,t,a){e.exports=a(110)}},[[95,1,2]]]);
//# sourceMappingURL=main.cade761d.chunk.js.map