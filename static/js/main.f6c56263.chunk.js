(this["webpackJsonpgv-targeterfassung"]=this["webpackJsonpgv-targeterfassung"]||[]).push([[0],{102:function(e,t,n){e.exports=n(118)},108:function(e,t,n){},117:function(e,t,n){},118:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(10),o=n.n(c),l=n(85),i=n(6),s=n(46),u=n.n(s),m=n(68),g=n(155),d=n(77),f=n.n(d);n(108);function b(){return new Promise((function(e,t){var n=indexedDB.open("Au\xdfendienstDB",1);n.onupgradeneeded=function(e){e.target.result.createObjectStore("submissions",{keyPath:"id",autoIncrement:!0})},n.onsuccess=function(t){var n=t.target.result;e(n)},n.onerror=function(e){t(e.target.error)}}))}function p(e,t){return new Promise((function(n,a){var r=e.transaction(["submissions"],"readwrite").objectStore("submissions").add(t);r.onsuccess=function(){n()},r.onerror=function(){a(r.error)}}))}function v(e){return new Promise((function(t,n){var a=e.transaction(["submissions"],"readonly").objectStore("submissions").getAll();a.onsuccess=function(){t(a.result)},a.onerror=function(){n(a.error)}}))}var h=n(78),E=n.n(h),k=n(174),j=n(121),S=n(120),O=n(158),w=n(162),x=n(166),y=n(167),D=n(178),C=n(160),V=n(179),I=n(163),_=n(177),L=n(184),N=n(165),R=n(180),W=Object(g.a)((function(e){return{title:{fontWeight:"bold",fontSize:"1.2rem",marginBottom:"5px"}}})),A=function(e){var t=e.value,n=e.setValue,a=e.name,c=e.disabled,o=W();return r.a.createElement(r.a.Fragment,null,r.a.createElement(S.a,{variant:"h5",className:o.title},a),r.a.createElement(R.a,{required:!0,disabled:c,fullWidth:!0,name:a,value:t,onChange:function(e){var t=e.target.value;"Streckennummer"===a&&(t=Math.max(0,parseInt(t,10)).toString().slice(0,4)),n(t)},margin:"normal",inputProps:{style:{textAlign:"center"}}}),r.a.createElement("br",null))},P=n(83),z=n.n(P),F=n(45),T=n.n(F),B=Object(g.a)((function(e){return{button:{margin:e.spacing(1),padding:"10px 20px",fontSize:"1rem",textTransform:"none"},buttonsContainer:{display:"flex",flexDirection:"row",alignItems:"center"},buttonContainer:{textAlign:"center",marginTop:e.spacing(2)}}})),U=function(e){var t=e.handleSubmit,n=e.downloadCombinedTodayData,a=e.downloadCombinedData,c=B();return r.a.createElement(k.a,{className:c.buttonContainer},r.a.createElement(w.a,{variant:"contained",color:"primary",className:c.button,endIcon:r.a.createElement(z.a,null),onClick:t},"Abspeichern"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(k.a,{className:c.buttonsContainer},r.a.createElement(w.a,{variant:"contained",color:"primary",className:c.button,startIcon:r.a.createElement(T.a,null),onClick:function(){return n()}},"Daten von heute herunterladen"),r.a.createElement(w.a,{variant:"contained",color:"primary",className:c.button,startIcon:r.a.createElement(T.a,null),onClick:function(){return a()}},"Alle Daten herunterladen")))},M=n(39),K=n.n(M),q=n(183),G=n(175),H=n(182),J=Object(g.a)((function(e){return{title:{fontWeight:"bold",fontSize:"1.2rem",marginBottom:"5px",textAlign:"center"},textField:{marginBottom:"1px"}}})),$=function(e,t){var n=J(),c=Object(a.useState)(""),o=Object(i.a)(c,2),l=o[0],s=o[1],u=Object(a.useState)(""),m=Object(i.a)(u,2),g=m[0],d=m[1],f=Object(a.useState)(""),h=Object(i.a)(f,2),E=h[0],j=h[1],O=Object(a.useState)(!1),w=Object(i.a)(O,2),x=w[0],y=w[1],W=Object(a.useState)(""),P=Object(i.a)(W,2),z=P[0],F=P[1],T=Object(a.useState)(""),B=Object(i.a)(T,2),M=B[0],$=B[1],Q=Object(a.useState)(null),X=Object(i.a)(Q,2),Y=X[0],Z=X[1],ee=Object(a.useState)(""),te=Object(i.a)(ee,2),ne=te[0],ae=te[1],re=Object(a.useState)(""),ce=Object(i.a)(re,2),oe=ce[0],le=ce[1],ie=Object(a.useState)(null),se=Object(i.a)(ie,2),ue=se[0],me=se[1],ge=(e.onClose,e.selectedValue,e.open,Object(a.useState)("")),de=Object(i.a)(ge,2),fe=de[0],be=de[1],pe=Object(a.useState)(""),ve=Object(i.a)(pe,2),he=ve[0],Ee=ve[1],ke=Object(a.useState)([]),je=Object(i.a)(ke,2),Se=je[0],Oe=je[1],we=Object(a.useState)(!1),xe=Object(i.a)(we,2),ye=(xe[0],xe[1]),De=Object(a.useState)(""),Ce=Object(i.a)(De,2),Ve=Ce[0],Ie=Ce[1];Object(a.useEffect)((function(){Ie((new Date).toISOString().slice(0,10))}),[Ve,Ie]);var _e=Object(a.useRef)(null),Le=[{value:10,label:"Keiner"},{value:20,label:"Laterne"},{value:30,label:"Wand"},{value:40,label:"Fundament"},{value:50,label:"L\xe4rmschutzwand"},{value:60,label:"Widerlager"},{value:70,label:"Sonstiges"}];return r.a.createElement(D.a,{open:e.open,onClose:e.onClose},r.a.createElement(k.a,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",maxWidth:"400px",margin:"0 auto",padding:"20px",marginTop:"10px",border:"1px solid #ccc",borderRadius:"8px",boxShadow:"0 0 5px rgba(0, 0, 0, 0.2)"},r.a.createElement(A,{name:"Streckennummer",value:l,setValue:s}),r.a.createElement(S.a,{variant:"h6",className:n.title},"Kilometrierung"),r.a.createElement(k.a,{display:"flex",flexDirection:"row",alignItems:"center"},r.a.createElement(R.a,{required:!0,value:g,style:{marginRight:"5px"},id:"km",name:"km",placeholder:"z.B. 145",onChange:function(e){return d(e.target.value)},inputProps:{style:{textAlign:"center"}}}),r.a.createElement(S.a,null,", "),r.a.createElement(R.a,{required:!0,value:E,style:{marginLeft:"5px"},id:"met",name:"met",placeholder:"02",onChange:function(e){return j(e.target.value)},inputProps:{style:{textAlign:"center"}}})),r.a.createElement("br",null),r.a.createElement(S.a,{variant:"h6",className:n.title},"Seite"),r.a.createElement(k.a,{display:"flex",flexDirection:"row",alignItems:"center"},r.a.createElement(C.a,{component:"fieldset"},r.a.createElement(V.a,{row:!0,required:!0,id:"seite",name:"seite",value:x,onChange:function(e){return y(e.target.value)}},r.a.createElement(I.a,{value:"L",control:r.a.createElement(_.a,null),label:"L"}),r.a.createElement(I.a,{value:"R",control:r.a.createElement(_.a,null),label:"R"}))),r.a.createElement(R.a,{fullWidth:!0,value:z,onChange:function(e){return F(e.target.value)},label:"Sonstiges",id:"sonstiges",name:"sonstiges",InputLabelProps:{style:{textAlign:"center",width:"100%",marginLeft:"0"}},inputProps:{style:{textAlign:"center"}}})),r.a.createElement("br",null),r.a.createElement(A,{name:"Mastnummer",value:M,setValue:$,disabled:null!==Y&&10!==Y}),r.a.createElement(S.a,{variant:"h6",className:n.title},"Wenn keine Mastnummer vorhanden ist, dann Vermarkungstr\xe4ger ausw\xe4hlen:"),r.a.createElement(C.a,{fullWidth:!0},r.a.createElement(H.a,{id:"demo-simple-select-label"},"Vermarkungstr\xe4ger"),r.a.createElement(G.a,{labelId:"vermarkungstraeger",id:"vermarkungstraeger",value:Y,label:"Vermarkung",onChange:function(e){return function(e){Z(e.target.value),e.target.value&&$("")}(e)},disabled:!!M},Le.map((function(e){return r.a.createElement(q.a,{key:e.value,value:e.value},e.label)})))),r.a.createElement(A,{name:"Sonstiges",value:ne,setValue:ae,disabled:70!==Y}),r.a.createElement("br",null),r.a.createElement(A,{name:"GVP L\xe4nge, mm",value:oe,setValue:le}),r.a.createElement("br",null),r.a.createElement(S.a,{variant:"h6",className:n.title},"Datum"),r.a.createElement("br",null),r.a.createElement(R.a,{required:!0,fullWidth:!0,name:"currentDate",placeholder:"z.B. 2023-10-20",value:Ve,onChange:function(e){Ie(e.target.value)},margin:"normal",inputProps:{style:{textAlign:"center"}}}),r.a.createElement("br",null),r.a.createElement(S.a,{variant:"h6",className:n.title},"Foto hochladen"),r.a.createElement("input",{ref:function(e){return _e.current=e},required:!0,type:"file",name:"photo",accept:"image/*;capture=camera",onChange:function(e){return function(e){var t=e.target.files[0];me(t)}(e)}})),r.a.createElement(U,{handleSubmit:function(){if(!ue)return Ee("Bitte w\xe4hlen Sie ein Foto aus, bevor Sie fortfahren."),void be("");Ee(""),be("Erfolgreich hinzugef\xfcgt"),s(""),d(""),j(""),y(!1),F(""),$(""),Z(null),le(""),ae(""),me(null),Ie((new Date).toISOString().slice(0,10)),console.log();var e=new FileReader;e.onload=function(e){var t=e.target.result,n=.9,a=new Image;a.src=t,a.onload=function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=a.width,e.height=a.height,t.drawImage(a,0,0,a.width,a.height);for(var r=e.toDataURL("image/jpeg",n);r.length>524288&&n>=.1;)n-=.1,r=e.toDataURL("image/jpeg",n);if(r.length<=524288){var c,o=Y?null===(c=Le.find((function(e){return e.value===Y})))||void 0===c?void 0:c.label:"",i={streckennummer:l,km:g,met:E,seite:x,sonstiges:z,mastnummer:M,selectedVermarkungstrager:o,sonstiges2:ne,gvp:oe,currentDate:Ve,photo:r};b().then((function(e){p(e,i).then((function(){v(e).then((function(e){Oe(e),be("Erfolgreich hinzugef\xfcgt"),ye(!0)})).catch((function(e){return console.error("Error fetching submissions: ",e)}))})).catch((function(e){return console.error("Error adding submission: ",e)}))})).catch((function(e){return console.error("Error opening database: ",e)}))}else console.error("Compressed photo size is still too large.")}},e.readAsDataURL(ue),_e.current.value=""},downloadCombinedData:function(){var e=new K.a,t="Streckennummer;Kilometrierung; Seite; Sonstiges; Mastnummer; Vermarkung; Sonstiges Vermarkung; GVP L\xe4nge; Datum\n"+Se.map((function(e){var t=(e.gvp/1e3).toLocaleString("de-DE",{minimumFractionDigits:2});return"".concat(e.streckennummer,";").concat(e.km,",").concat(e.met,";").concat(e.seite,";").concat(e.sonstiges,";").concat(e.mastnummer,";").concat(e.selectedVermarkungstrager,";").concat(e.sonstiges2,";").concat(t,";").concat(e.currentDate)})).join("\n");e.file("alle_daten.csv",t),Se.forEach((function(t,n){var a,r=t.currentDate.replace(/-/g,"");if(t.mastnummer)a="".concat(t.streckennummer,"_").concat(t.km,",").concat(t.met,"_").concat(t.seite,"_").concat(t.mastnummer,"_").concat(r,".jpg");else if(t.selectedVermarkungstrager&&"Sonstiges"!==t.selectedVermarkungstrager)a="".concat(t.streckennummer,"_").concat(t.km,",").concat(t.met,"_").concat(t.seite,"_").concat(t.selectedVermarkungstrager,"_").concat(r,".jpg");else{if(!t.sonstiges2)return void console.error("Invalid submission data");a="".concat(t.streckennummer,"_").concat(t.km,",").concat(t.met,"_").concat(t.seite,"_").concat(t.sonstiges2,"_").concat(r,".jpg")}var c=t.photo.split(",")[1];e.file(a,c,{base64:!0})})),e.generateAsync({type:"blob"}).then((function(e){var t=window.URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="combined_data.zip",setTimeout((function(){n.click()}),100)}))},downloadCombinedTodayData:function(){var e=new K.a,t=Se.filter((function(e){return e.currentDate===Ve})),n="Streckennummer;Kilometrierung; Seite; Sonstiges; Mastnummer; Vermarkung; Sonstiges Vermarkung; GVP L\xe4nge; Datum\n"+t.map((function(e){var t=(e.gvp/1e3).toLocaleString("de-DE",{minimumFractionDigits:2});return"".concat(e.streckennummer,";").concat(e.km,",").concat(e.met,";").concat(e.seite,";").concat(e.sonstiges,";").concat(e.mastnummer,";").concat(e.selectedVermarkungstrager,";").concat(e.sonstiges2,";").concat(t,";").concat(Ve)})).join("\n");e.file("".concat(Ve,".csv"),n),t.forEach((function(t,n){var a,r=t.currentDate.replace(/-/g,"");if(t.mastnummer)a="".concat(t.streckennummer,"_").concat(t.km,",").concat(t.met,"_").concat(t.seite,"_").concat(t.mastnummer,"_").concat(r,".jpg");else if(t.selectedVermarkungstrager&&"Sonstiges"!==t.selectedVermarkungstrager)a="".concat(t.streckennummer,"_").concat(t.km,",").concat(t.met,"_").concat(t.seite,"_").concat(t.selectedVermarkungstrager,"_").concat(r,".jpg");else{if(!t.sonstiges2)return void console.error("Invalid submission data");a="".concat(t.streckennummer,"_").concat(t.km,",").concat(t.met,"_").concat(t.seite,"_").concat(t.sonstiges2,"_").concat(r,".jpg")}var c=t.photo.split(",")[1];e.file(a,c,{base64:!0})})),e.generateAsync({type:"blob"}).then((function(e){var t=(new Date).toISOString().slice(0,10),n=window.URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download="".concat(t,".zip"),setTimeout((function(){a.click()}),100)}))}}),r.a.createElement(L.a,{open:!!fe,autoHideDuration:6e3,onClose:function(e,t){"clickaway"!==t&&be("")}},r.a.createElement(N.a,{message:fe})),r.a.createElement(L.a,{open:!!he,autoHideDuration:6e3,onClose:function(e,t){"clickaway"!==t&&Ee("")}},r.a.createElement(N.a,{message:he})))},Q=Object(g.a)((function(e){return{header:{padding:e.spacing(2),backgroundColor:e.palette.primary.main,color:e.palette.common.white},content:{padding:e.spacing(3),backgroundColor:e.palette.background.paper},buttonContainer:{marginTop:e.spacing(2),textAlign:"center"},button:{display:"block",margin:"10px auto",padding:"10px 20px",fontSize:"1rem",textTransform:"none",backgroundColor:"#6a8dbb",color:e.palette.common.white,"&:hover":{backgroundColor:"#3c5a7d"}},input:{display:"none"}}})),X=function(e){var t=e.setShowTable,n=e.setImportData,c=e.setColNames,o=Q(),l=Object(a.useState)(!1),s=Object(i.a)(l,2),u=s[0],m=s[1],g=Object(a.useState)(!1),d=Object(i.a)(g,2),f=(d[0],d[1]),b=Object(a.useState)(!1),p=Object(i.a)(b,2),v=p[0],h=p[1];return r.a.createElement(k.a,null,r.a.createElement(j.a,{className:o.header,elevation:3},r.a.createElement(S.a,{variant:"h4"},"GV-Targeterfassung")),r.a.createElement(j.a,{className:o.content,elevation:3},r.a.createElement(k.a,{className:o.buttonContainer},r.a.createElement("label",{htmlFor:"csv-input"},r.a.createElement(O.a,{accept:".csv",className:o.input,id:"csv-input",type:"file",onChange:function(e){var a=e.target.files[0];a?"text/csv"===a.type||a.name.endsWith(".csv")?(!function(e,t,n){E.a.parse(e,{complete:function(a){var r=e.name?e.name.split(".").at(0):"";if(a.data&&a.data.length>0){Object.keys(a.data[0]);var c=a.data.slice(0,-1),o=["PktNr","Km-Station Ist"],l=c.map((function(e,t){var n={id:t,Streckennummer:r,Mastnummer:"","GVP L\xe4nge":""};return o.forEach((function(t){n[t]=e[t]})),n}));t(l),n([].concat(o,["Streckennummer","Mastnummer","GVP L\xe4nge"]))}else console.error("CSV file is empty or missing data.")},header:!0,encoding:"ISO-8859-1"})}(a,n,c),t(!0),f(!0),h(!1)):(h(!0),f(!1)):(f(!1),h(!1))}}),r.a.createElement(w.a,{variant:"contained",startIcon:r.a.createElement(x.a,null),color:"secondary",className:o.button,component:"span"},"Koordinatendatei hochladen")),v&&r.a.createElement(S.a,{variant:"body2",color:"error"},"W\xe4hlen Sie eine CSV Datei")),r.a.createElement(k.a,null,r.a.createElement(w.a,{variant:"contained",startIcon:r.a.createElement(y.a,null),color:"secondary",className:o.button,component:"span",onClick:function(){m(!0)}},"Formular \xf6ffnen"),r.a.createElement($,{selectedValue:"",open:u,onClose:function(e){m(!1)}}))))},Y=n(169),Z=n(173),ee=n(172),te=n(168),ne=n(170),ae=n(171),re=n(62),ce=n(65),oe=Object(g.a)((function(e){return{title:{fontWeight:"bold",fontSize:"1.2rem",marginBottom:"5px"},textField:{marginBottom:"1px"}}})),le=function(e){var t=e.reff,n=e.row,c=e.setImportData,o=Object(a.useState)({seite:!1,sonstiges:"",gvp:"",photo:null}),l=Object(i.a)(o,2),s=l[0],u=l[1],m=Object(a.useState)(n.Streckennummer?n.Streckennummer:""),g=Object(i.a)(m,2),d=g[0],f=g[1],h=Object(a.useState)(n["Km-Station Ist"]?n["Km-Station Ist"]:""),E=Object(i.a)(h,2),j=E[0],O=E[1],w=Object(a.useState)(n.Met?n.Met:""),x=Object(i.a)(w,2),y=x[0],D=x[1],W=Object(a.useState)(""),P=Object(i.a)(W,2),z=P[0],F=P[1],T=Object(a.useState)(""),B=Object(i.a)(T,2),M=B[0],J=B[1],$=Object(a.useState)(""),Q=Object(i.a)($,2),X=Q[0],Y=Q[1],Z=Object(a.useState)(null),ee=Object(i.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(a.useState)(""),le=Object(i.a)(ae,2),ie=le[0],se=le[1],ue=Object(a.useState)(""),me=Object(i.a)(ue,2),ge=me[0],de=me[1],fe=Object(a.useState)(""),be=Object(i.a)(fe,2),pe=be[0],ve=be[1],he=Object(a.useState)(""),Ee=Object(i.a)(he,2),ke=Ee[0],je=Ee[1],Se=Object(a.useState)(""),Oe=Object(i.a)(Se,2),we=Oe[0],xe=Oe[1],ye=Object(a.useState)([]),De=Object(i.a)(ye,2),Ce=De[0],Ve=De[1];Object(a.useEffect)((function(){c((function(e){return e.map((function(e){return e.id===n.id?Object(ce.a)({},e,{"GVP L\xe4nge":ge}):e.id===n.id?Object(ce.a)({},e,{Mastnummer:X}):e}))}))}),[ge,X,n.id,c]);var Ie=Object(a.useState)(!1),_e=Object(i.a)(Ie,2),Le=(_e[0],_e[1]),Ne=Object(a.useState)(""),Re=Object(i.a)(Ne,2),We=Re[0],Ae=Re[1];Object(a.useEffect)((function(){if(Ae((new Date).toISOString().slice(0,10)),n){if(n["Km-Station Ist"]){var e=n["Km-Station Ist"].split(","),t=Object(i.a)(e,2),a=t[0],r=t[1];O(a),D(r)}n.Seite&&F(n.Seite)}}),[n,Ae]);var Pe=oe(),ze=[{value:10,label:"Keiner"},{value:20,label:"Laterne"},{value:30,label:"Wand"},{value:40,label:"Fundament"},{value:50,label:"L\xe4rmschutzwand"},{value:60,label:"Widerlager"},{value:70,label:"Sonstiges"}],Fe=function(e){var t=e.target,n=t.name,a=t.value;u(Object(ce.a)({},s,Object(re.a)({},n,a)))};return Object(a.useEffect)((function(){b().then((function(e){v(e).then((function(e){return Ve(e)}))})).catch((function(e){return console.error("Error opening database: ",e)}))}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(k.a,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",maxWidth:"400px",margin:"0 auto",padding:"20px",border:"1px solid #ccc",borderRadius:"8px",boxShadow:"0 0 5px rgba(0, 0, 0, 0.2)"},r.a.createElement(A,{value:d,setValue:f,name:"Streckennummer"}),r.a.createElement(S.a,{variant:"h6",className:Pe.title},"Kilometrierung"),r.a.createElement(k.a,{display:"flex",flexDirection:"row",alignItems:"center"},r.a.createElement(R.a,{required:!0,style:{marginRight:"5px"},id:"km",name:"km",placeholder:"z.B. 145",value:j,onChange:Fe,inputProps:{style:{textAlign:"center"}}}),r.a.createElement(S.a,null,", "),r.a.createElement(R.a,{required:!0,style:{marginLeft:"5px"},id:"met",name:"met",placeholder:"02",value:y,onChange:Fe,inputProps:{style:{textAlign:"center"}}})),r.a.createElement("br",null),r.a.createElement(S.a,{variant:"h6",className:Pe.title},"Seite"),r.a.createElement(k.a,{display:"flex",flexDirection:"row",alignItems:"center"},r.a.createElement(C.a,{component:"fieldset"},r.a.createElement(V.a,{row:!0,required:!0,id:"seite",name:"seite",value:z,onChange:function(e){return F(e.target.value)}},r.a.createElement(I.a,{value:"L",control:r.a.createElement(_.a,null),label:"L"}),r.a.createElement(I.a,{value:"R",control:r.a.createElement(_.a,null),label:"R"}))),r.a.createElement(R.a,{fullWidth:!0,label:"Sonstiges",id:"sonstiges",name:"sonstiges",value:M,onChange:function(e){return J(e.target.value)},inputProps:{style:{textAlign:"center"}},InputLabelProps:{style:{textAlign:"center",width:"100%",marginLeft:"0"}}})),r.a.createElement("br",null),r.a.createElement(A,{name:"Mastnummer",value:X,setValue:Y,disabled:null!==te&&10!==te}),r.a.createElement(S.a,{variant:"h6",className:Pe.title},"Wenn keine Mastnummer vorhanden ist, dann Vermarkungstr\xe4ger ausw\xe4hlen:"),r.a.createElement(C.a,{fullWidth:!0},r.a.createElement(H.a,{id:"demo-simple-select-label"},"Vermarkungstr\xe4ger"),r.a.createElement(G.a,{labelId:"vermarkungstraeger",id:"vermarkungstraeger",value:te,label:"Vermarkung",onChange:function(e){return function(e){ne(e.target.value),e.target.value&&Y("")}(e)},disabled:!!X},ze.map((function(e){return r.a.createElement(q.a,{key:e.value,value:e.value},e.label)})))),r.a.createElement(A,{name:"Sonstiges",value:ie,setValue:se,disabled:70!==te}),r.a.createElement("br",null),r.a.createElement(A,{value:ge,setValue:de,name:"GVP L\xe4nge, mm"}),r.a.createElement("br",null),r.a.createElement(S.a,{variant:"h6",className:Pe.title},"Datum"),r.a.createElement("br",null),r.a.createElement(R.a,{required:!0,fullWidth:!0,name:"currentDate",placeholder:"z.B. 2023-10-20",value:We,onChange:function(e){Ae(e.target.value)},margin:"normal",inputProps:{style:{textAlign:"center"}}}),r.a.createElement("br",null),r.a.createElement(S.a,{variant:"h6",className:Pe.title},"Foto hochladen"),r.a.createElement("input",{ref:function(e){return t.current=e},required:!0,type:"file",name:"photo",accept:"image/*;capture=camera",onChange:function(e){var t=e.target.files[0];ve(t)}})),r.a.createElement(U,{handleSubmit:function(){if(!pe)return xe("Bitte w\xe4hlen Sie ein Foto aus, bevor Sie fortfahren."),void je("");xe(""),je("Erfolgreich hinzugef\xfcgt");var e=new FileReader;e.onload=function(e){var t=e.target.result,n=.9,a=new Image;a.src=t,a.onload=function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=a.width,e.height=a.height,t.drawImage(a,0,0,a.width,a.height);for(var r=e.toDataURL("image/jpeg",n);r.length>524288&&n>=.1;)n-=.1,r=e.toDataURL("image/jpeg",n);if(r.length<=524288){var c,o=te?null===(c=ze.find((function(e){return e.value===te})))||void 0===c?void 0:c.label:"",l={streckennummer:d,km:j,met:y,seite:z,sonstiges:M,mastnummer:X,selectedVermarkungstrager:o,sonstiges2:ie,gvp:ge,currentDate:We,photo:r};b().then((function(e){p(e,l).then((function(){v(e).then((function(e){Ve(e),je("Erfolgreich hinzugef\xfcgt"),Le(!0)})).catch((function(e){return console.error("Error fetching submissions: ",e)}))})).catch((function(e){return console.error("Error adding submission: ",e)}))})).catch((function(e){return console.error("Error opening database: ",e)}))}else console.error("Compressed photo size is still too large.")}},e.readAsDataURL(pe),t.current.value=""},downloadCombinedData:function(){var e=new K.a,t="Streckennummer;Kilometrierung; Seite; Sonstiges; Mastnummer; Vermarkung; Sonstiges Vermarkung; GVP L\xe4nge; Datum\n"+Ce.map((function(e){var t=(e.gvp/1e3).toLocaleString("de-DE",{minimumFractionDigits:2});return"".concat(e.streckennummer,";").concat(e.km,",").concat(e.met,";").concat(e.seite,";").concat(e.sonstiges,";").concat(e.mastnummer,";").concat(e.selectedVermarkungstrager,";").concat(e.sonstiges2,";").concat(t,";").concat(e.currentDate)})).join("\n");e.file("alle_daten.csv",t),Ce.forEach((function(t,n){var a,r=t.currentDate.replace(/-/g,"");if(t.mastnummer)a="".concat(t.streckennummer,"_").concat(t.km,",").concat(t.met,"_").concat(t.seite,"_").concat(t.mastnummer,"_").concat(r,".jpg");else if(t.selectedVermarkungstrager&&"Sonstiges"!==t.selectedVermarkungstrager)a="".concat(t.streckennummer,"_").concat(t.km,",").concat(t.met,"_").concat(t.seite,"_").concat(t.selectedVermarkungstrager,"_").concat(r,".jpg");else{if(!t.sonstiges2)return void console.error("Invalid submission data");a="".concat(t.streckennummer,"_").concat(t.km,",").concat(t.met,"_").concat(t.seite,"_").concat(t.sonstiges2,"_").concat(r,".jpg")}var c=t.photo.split(",")[1];e.file(a,c,{base64:!0})})),e.generateAsync({type:"blob"}).then((function(e){var t=window.URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="combined_data.zip",setTimeout((function(){n.click()}),100)}))},downloadCombinedTodayData:function(){var e=new K.a,t=Ce.filter((function(e){return e.currentDate===We})),n="Streckennummer;Kilometrierung; Seite; Sonstiges; Mastnummer; Vermarkung; Sonstiges Vermarkung; GVP L\xe4nge; Datum\n"+t.map((function(e){var t=(e.gvp/1e3).toLocaleString("de-DE",{minimumFractionDigits:2});return"".concat(e.streckennummer,";").concat(e.km,",").concat(e.met,";").concat(e.seite,";").concat(e.sonstiges,";").concat(e.mastnummer,";").concat(e.selectedVermarkungstrager,";").concat(e.sonstiges2,";").concat(t,";").concat(We)})).join("\n");e.file("".concat(We,".csv"),n),t.forEach((function(t,n){var a,r=t.currentDate.replace(/-/g,"");if(t.mastnummer)a="".concat(t.streckennummer,"_").concat(t.km,",").concat(t.met,"_").concat(t.seite,"_").concat(t.mastnummer,"_").concat(r,".jpg");else if(t.selectedVermarkungstrager&&"Sonstiges"!==t.selectedVermarkungstrager)a="".concat(t.streckennummer,"_").concat(t.km,",").concat(t.met,"_").concat(t.seite,"_").concat(t.selectedVermarkungstrager,"_").concat(r,".jpg");else{if(!t.sonstiges2)return void console.error("Invalid submission data");a="".concat(t.streckennummer,"_").concat(t.km,",").concat(t.met,"_").concat(t.seite,"_").concat(t.sonstiges2,"_").concat(r,".jpg")}var c=t.photo.split(",")[1];e.file(a,c,{base64:!0})})),e.generateAsync({type:"blob"}).then((function(e){var t=(new Date).toISOString().slice(0,10),n=window.URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download="".concat(t,".zip"),setTimeout((function(){a.click()}),100)}))}}),r.a.createElement(L.a,{open:!!ke,autoHideDuration:6e3,onClose:function(e,t){"clickaway"!==t&&je("")}},r.a.createElement(N.a,{message:ke})),r.a.createElement(L.a,{open:!!we,autoHideDuration:6e3,onClose:function(e,t){"clickaway"!==t&&xe("")}},r.a.createElement(N.a,{message:we})))},ie=n(164),se=n(84),ue=n.n(se),me=Object(g.a)((function(e){return{paper:{padding:e.spacing(3)},successSnackbar:{backgroundColor:"#92b493"},errorSnackbar:{backgroundColor:"#FF5722"},buttonContainer:{textAlign:"center",marginTop:e.spacing(2)},button:{margin:e.spacing(1),padding:"10px 20px",fontSize:"1rem",textTransform:"none"}}}));function ge(e){var t=e.row,n=e.onClose,a=e.selectedValue,c=e.open,o=e.reff,l=e.setImportData,i=me();return r.a.createElement(D.a,{onClose:function(){n(a)},"aria-labelledby":"simple-dialog-title",open:c},r.a.createElement(j.a,{elevation:3,className:i.paper},r.a.createElement(le,{row:t,reff:o,setImportData:l})))}var de=function(e){var t=e.row,n=e.reff,a=e.selectedRowData,c=e.setImportData,o=me(),l=r.a.useState(!1),s=Object(i.a)(l,2),u=s[0],m=s[1],g=r.a.useState([]),d=Object(i.a)(g,2),f=d[0],b=d[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:o.buttonContainer},r.a.createElement(ie.a,{"aria-label":"edit",onClick:function(){m(!0)},className:o.button},"Bearbeiten",r.a.createElement(ue.a,null)),r.a.createElement(ge,{row:t,selectedValue:f,open:u,onClose:function(e){m(!1),b(a)},reff:n,selectedRowData:a,setImportData:c})))},fe=Object(g.a)((function(e){return{table:{minWidth:650},tableHead:{backgroundColor:"#6a8dbb",color:e.palette.common.white},editButton:{color:e.palette.secondary.main}}})),be=function(e){var t=e.importData,n=e.reff,a=e.setImportData,c=e.colNames;console.log(c);var o=fe();return r.a.createElement(te.a,{component:j.a},r.a.createElement(Y.a,{className:o.table,"aria-label":"enhanced table"},r.a.createElement(ne.a,null,r.a.createElement(ae.a,{className:o.tableHead},c.map((function(e,t){return r.a.createElement(ee.a,{key:"keys-".concat(t),align:"right"},e)})),r.a.createElement(ee.a,{key:"keys-edit",align:"right"}))),r.a.createElement(Z.a,null,t.map((function(e,t){return r.a.createElement(ae.a,{key:t},c.map((function(t,n){return r.a.createElement(ee.a,{key:"values-".concat(n),align:"right"},e[t])})),r.a.createElement(ee.a,{key:"values-edit",align:"right"},r.a.createElement(de,{row:e,reff:n,setImportData:a})))})))))},pe=Object(g.a)((function(e){return{root:{flexWrap:"wrap",width:"100%",height:"100%",backgroundColor:"#f4f4f4",display:"flex",justifyContent:"center","& > *":{padding:"10px",display:"flex",flexDirection:"column"}}}})),ve=function(){var e=Object(m.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=t.transaction(["submissions"],"readwrite").objectStore("submissions").clear();a.onsuccess=function(){e()},a.onerror=function(e){n(e.target.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=pe(),t=Object(a.useRef)(null),n=Object(a.useState)(!1),c=Object(i.a)(n,2),o=c[0],s=c[1],g=Object(a.useState)([]),d=Object(i.a)(g,2),p=d[0],v=d[1],h=Object(a.useState)([]),E=Object(i.a)(h,2),k=E[0],j=E[1],S=Object(a.useState)(!1),O=Object(i.a)(S,2),x=O[0],y=O[1];Object(a.useEffect)((function(){var e=function(){var e=Object(m.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b();case 3:return t=e.sent,e.next=6,ve(t);case 6:console.log("IndexedDB cleared."),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error clearing IndexedDB: ",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),t=new Date,n=new Date(t);n.setHours(24,0,0,0);var a=12096e5+(n-t),r=setInterval(e,a);return console.log(a),function(){clearInterval(r)}}),[]);return r.a.createElement("div",{className:f()(e.root,"appWrapper")},r.a.createElement(X,{setShowTable:function(e){y(e),s(e)},setImportData:v,setColNames:j}),x&&r.a.createElement(r.a.Fragment,null,r.a.createElement(be,{importData:p,reff:t,setImportData:v,colNames:k}),o&&r.a.createElement(w.a,{variant:"contained",color:"primary",style:{height:"50px",marginTop:"10px"},className:e.button,startIcon:r.a.createElement(T.a,null),onClick:function(){var e=function(e){if(!e||0===e.length)return"";var t=Object.keys(e[0]),n=t.join(";"),a=e.map((function(e){return t.map((function(t){return e[t]})).join(";")}));return[n].concat(Object(l.a)(a)).join("\n")}(p),t=new Blob([e],{type:"text/csv"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download="table_data.csv",n.click()}},"Tabelle herunterladen")))},Ee=(n(117),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function ke(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(he,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/gv-targeterfassung-test",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/gv-targeterfassung-test","/service-worker.js");Ee?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ke(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):ke(t,e)}))}}()}},[[102,1,2]]]);
//# sourceMappingURL=main.f6c56263.chunk.js.map